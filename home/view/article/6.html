<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>如何在控制器开启事务处理?---XbPhp框架--争取智能化的框架,执行效率高,简单上手</title>
<meta name="keywords" content="XbPhp,XbPhp框架,PHP框架,PHP智能框架,跨平台框架" />
<meta name="description" content="XbPhp框架的宗旨是实现智能化，兼容性强,简单上手,不一样的文件缓存机制" />
<link rel="stylesheet" type="text/css" href="<{$herf}>css/style.css" />
<script type="text/javascript" src="<{$herf}>js/jquery-1.4.3.min.js"></script>
<style>
.head h1 a { 
	width: 260px; 
	height: 95px; 
	background-image: url(<{$herf}>images/logo.jpg); 
	text-indent: -9999px; 
	overflow: hidden;
}
.body .content ul p {
	font-size: 18px;
}
</style>
<{include file="header.html"}>
<div class="body">
	<div class="content">
		<ul>
			<p>我们创建一个home/controller目录下载创建一个IndexController.php,创建好,代码如下:</p>
			<pre class="brush:php; toolbar: true; auto-links: false;" style="font-size:12px">
			//必须要继承AppController
			&lt;?php  class IndexController extends AppController {
				&nbsp;&nbsp;//要加载的模型,此模型文件为数据表的名字,如 数据表的名字bc_wz,加载模型的写法如下
				&nbsp;&nbsp;public $uses = array('BcWz');
				&nbsp;&nbsp;//要自动初始化函数,必须在构造函数里面写上parent::__construct()先初始化父类
				&nbsp;&nbsp;public function _initialize() {
					&nbsp;&nbsp;&nbsp;&nbsp;parent::_initialize();
				&nbsp;&nbsp;}
				&nbsp;&nbsp; public function test() {
							&nbsp;&nbsp;&nbsp;&nbsp;//开启事务
							&nbsp;&nbsp;&nbsp;&nbsp;$this->BcWz->begin();
							&nbsp;&nbsp;&nbsp;&nbsp;$status = 1;
							&nbsp;&nbsp;&nbsp;&nbsp;$_data['bc_title'] = 1;
							&nbsp;&nbsp;&nbsp;&nbsp;$_data['bc_connect'] = 1;
							&nbsp;&nbsp;&nbsp;&nbsp;$_data['bc_jianjie'] = 1;
							&nbsp;&nbsp;&nbsp;&nbsp;$_data['bc_navid'] = 1;
							&nbsp;&nbsp;&nbsp;&nbsp;if(!$this->BcWz->save($_data)) {
							 	&nbsp;&nbsp;&nbsp;&nbsp;$status = 0;
							&nbsp;&nbsp;&nbsp;&nbsp;}
							&nbsp;&nbsp;&nbsp;&nbsp;if($status) {
								&nbsp;&nbsp;&nbsp;&nbsp;//事务提交
							 	&nbsp;&nbsp;&nbsp;&nbsp;$this->BcWz->commit();
							 	&nbsp;&nbsp;&nbsp;&nbsp;echo '成功<br>';
							&nbsp;&nbsp;&nbsp;&nbsp;}else {
								&nbsp;&nbsp;&nbsp;&nbsp;//事务回滚
								&nbsp;&nbsp;&nbsp;&nbsp;$this->BcWz->rollback();
								&nbsp;&nbsp;&nbsp;&nbsp;echo '失败<br>';
							&nbsp;&nbsp;&nbsp;&nbsp;}
				&nbsp;&nbsp;}
			} 
			?&gt;
			</pre>
			<p>这样我们在访问url:http://localhost/xbphp/Index/test/<br>
				这样执行成功就会输出成功，执行失败就会输出失败,事务处理主要用于多表提交, 金额的更新等，保证一个表保存失败,全部进行回滚

			</p>
		</ul>
	</div>
</div>
<script type="text/javascript" src="<{$herf}>js/shbrush.js"></script>
	<link type="text/css" rel="stylesheet" href="<{$herf}>css/shcore.css"/>
<link type="text/css" rel="stylesheet" href="<{$herf}>css/shthemedefault.css"/>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>
<{include file="footer.html"}>
</body>
</html>